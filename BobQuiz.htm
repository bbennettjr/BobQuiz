<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>Who is Bob Campbell</title>
	<link rel="stylesheet" type="text/css" href="./css/BobQuiz_style.css">
	<link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
	<script type="text/javascript" src="./js/jquery-3.1.1.js"></script>
	<script type="text/javascript" src="./js/bootstrap.min.js"></script>
	<script type="text/javascript" src="./js/CookieFunctions.js"></script>
	<script type="text/javascript" src="./js/BobQuiz_questions.js"></script>
	<script type="text/javascript">
		var answers = new Array(); //questions array defined in BobQuiz_questions.js
		var currentQuestion = 0;
		var NUMBER_OF_CHOICES = 5;
		var SPEED = 150; //milliseconds
		var emailtemp;

		$(document).ready(function() {
			updateUI();
			function updateUI() {
				var question = questions[currentQuestion];
				var choices = question.choices;
				var myData;
				$("#prompt").text(question.prompt);
				for (var i =  NUMBER_OF_CHOICES - 1; i >= 0; i--) {
					var myData = $("#choice_" + i + "_text");
					myData.text(choices[i]);
				}
				if (currentQuestion < answers.length) {
					var choice = $("tr").siblings()[answers[currentQuestion]];
					$(choice).addClass("active");
					$("#next").removeClass("inactive");
				}
				if (currentQuestion >= answers.length) {$("#next").addClass("inactive");}
				$("#counter_text").text(currentQuestion + 1);
				$("#container").animate({opacity:1.0}, SPEED);
			}

			// Log in to the website
			$("#login_button").click(function() {
				var email = $("#email").val();
				var pass = $("#pwd").val();
				var name;
				removeAlert("#logInAlert");
				if (!email || !pass) {
					$("#logInAlert").addClass("alert-warning").text("Please enter both your email and password.").show();
					return;
				} else {
					// create the email and pass check 
					if (typeof(Storage) !== "undefined") {
						if (localStorage[email]) {
							if (pass == localStorage[email]) {
								name = getCookieValue(email);
								name = name.replace(/[\s,]\w*/,""); // RegEx to search for space or comma and rest of string and replace with ""
								//animate the acceptance of login credentials
								$("#logInAlert").addClass("alert-success").text("Success!").show();
								$("#logInForm").modal('toggle');
								$("#home").fadeOut();
								$("#navbarLoggedOut").fadeOut();
								$("#welcomeMsg").text("Welcome, " + name);
								$("#navbarLoggedIn").fadeIn();
								$("#quiz").fadeIn();
							} else {
								$("#logInAlert").addClass("alert-danger").text("Your password does not match! Please try again.").show();
								return;
							}
						} else {
							$("#logInAlert").addClass("alert-info").text("You must be a new user. Please Sign Up first.").show();
							return;
						}
					} else {
						alert("Sorry there is no web storage support!");
						return;
					}
				}
			});

			// Sign up for the website
			$("#signup_button").click(function() {
				var email = $("#signUpEmail").val();
				var pass = $("#signUpPwd").val();
				removeAlert("#logInAlert");
				if (!email || !pass) {
					$("#signUpAlert").addClass("alert-warning").text("Please enter both your email and password.").show();
					return;
				} else {
					if (localStorage[email]) {
						$("#signUpAlert").addClass("alert-info").text("You're already signed up! Please Log In.").show();
						return;
					} else {
						localStorage.setItem(email, pass);
						setCookie(email, $("#firstName").val() + " " + $("#lastName").val());
						//animate change to sign up form and hide myForm, set cookie
						$("#signUpAlert").addClass("alert-success").text("Success!").show();
						$("#signupForm").modal('toggle');
						$("#home").fadeOut();
						$("#home").fadeOut();
						$("#navbarLoggedOut").fadeOut();
						$("#welcomeMsg").text("Welcome, " + $("#firstName").val());
						$("#navbarLoggedIn").fadeIn();
						$("#quiz").fadeIn();
					}
				}
			});

			// Remove the alert status before placing a new status
			function removeAlert(cl) {
				$(cl).removeClass("alert-success alert-info alert-warning alert-danger");
			}

			function showWelcome(container, id) {
				var name = getCookieValue(id);
				name = name.replace(/[\s,]\w*/,""); // RegEx to search for space or comma and rest of string and replace with ""
				if (name) {
					$(container).animate({opacity: '0.0'}, "fast", welcomeMsg);
				} else {
					alert("Sorry but we could not find your name in our registry");
				}
				function welcomeMsg() {
						$(container).hide();
						var welcText = "Welcome";
						container == "#myForm" ? welcText += " back to the jungle, ":welcText += " to Bob's quiz, "; // Fast enumeration of if statement
						welcText += name + "!";
						$("#welcome_header").text(welcText);
						$("#welcome").show();
						setTimeout(showQuiz, 3000); // Show the welcome for 3 seconds
				}
				function showQuiz() {
					$("#login").animate({opacity: 0.0}, "fast", function() {
						$("#login").hide();
						$("#quiz").show();
						$("#nav").show();
					});
				}
			}

			$("#next").click(function() {
				var myAnswer = $("#choices").children().children("tr.active");
				if (myAnswer.length == 0) {
					alert("Select an answer or the puppy gets it!");
					return;					
				}
				else {
					//log answer and prep for next question
					$("tr").removeClass("active");
					var myAnswer = myAnswer.attr("id");
					myAnswer = parseInt(myAnswer);
					if (currentQuestion < questions.length - 1) {
						answers[currentQuestion] = myAnswer; 
						currentQuestion++;
						//do quick animation of transition first
						$("#container").animate({opacity:0.0}, SPEED, updateUI);
					} else {
						$("#container").animate({opacity:0.0}, SPEED, presentScore);
					}
				}
			});

			$("#back").click(function() {
				if (currentQuestion <= 0) {
					return;
				} else {
					$("#container").animate({opacity:0},SPEED,updateUI);
					$("tr").removeClass("active");
					currentQuestion --;
				}
			});

			$("tr").click(function() {
				$(this).toggleClass("success");
				$(this).siblings("tr.success").toggleClass("success");
				if ($("#choices").children().children("tr.active").length == 0) {
					$("#next").addClass("inactive");				
				} else {
					$("#next").removeClass("inactive");									
				}
			});

			function presentScore() {
				var final = document.getElementById("final");
				var score = tallyScore();
				var totalQuestions = questions.length;
				var percentScore = Math.round(100 * score / totalQuestions);
				if (percentScore > 80.0) {
					$("#prompt").text("Wow! How do you know all of Bob's secrets? Are you God?");
				} else if (percentScore > 45.0) {
					$("#prompt").text("Definitely cheating off of Hector.");
				} else if (percentScore > 25.0) {
					$("#prompt").text("Mickey still nose more than you.");
				} else {
					$("#prompt").text("Who is this? Someone call security...Odie!");
				}
				$("#container").animate({opacity:1.0}, SPEED);
				$("#container_choices").hide();
				$("#back").hide();
				$("#counter").hide();
				$("#next").hide();
				$("#container_prompt").append(final);
				$("#final").show();
				$("#reset").show();
				$("#finalDisplay").text("Your final score is " + percentScore + "%!\n" + "You correctly answered " + score + " / " + totalQuestions + ".");
			}

			function tallyScore() {
				var tally = 0;
				for (var i = 0; i < questions.length - 1; i++) {
					if (answers[i] == questions[i].correctAnswer) {
						tally++;
					}
				}
				return tally;
			}	

			$("#reset").click(function() {
				$("#container").animate({opacity:0.0}, 2 * SPEED, updateUI);
				$("#container_choices").show();
				$("#back").show();
				$("#counter").show();
				$("#next").show();
				$("#final").hide();
				$("#reset").hide();
				currentQuestion = 0;
				answers = new Array();
			});

		});
</script>
</head>
<body>
<!-- Top Navigation bar -->
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="#home">Campbell Clan</a>
			</div>
			<ul class="nav navbar-nav">
				<li class="active"><a href="#home">Home</a></li>
				<li><a href="#">Leaderboards</a></li>
				<li><a href="#">About</a></li>
			</ul>
			<ul id="navbarLoggedOut" class="nav navbar-nav navbar-right">
				<li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Log In</a></li>
				<li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
			</ul>
			<ul id="navbarLoggedIn" style="display: none;" class="nav navbar-nav navbar-right">
				<li><p id="welcomeMsg" class="navbar-text"></p></li>
				<li><a href="#"><span class="glyphicon glyphicon-log-out"></span> Log Out</a></li>
			</ul>
		</div>
	</nav>
	<!-- Jumbotron -->
	<div id="home" class="container">
		<div class="jumbotron">
			<h1>The Campbell Clan Quiz</h1>
			<p><span class="label label-primary">Discover</span> the real Bob Campbell and why Brad should be <span class="label label-danger">scared.</span></p>
		</div>
	<!-- Home page buttons -->
		<div class="row">
			<div class="col-sm-6 col-md-4">
				<div class="thumbnail">
					<a data-toggle="modal" data-target="#signupForm" role="button">
						<img class="img-rounded img-responsive" src="./imgs/sign-up-thumbnail.png" alt="Sign Up">
						<div class="caption">
							<h3 class="text-center">Sign Up</h3>
						</div>
					</a>
					<div style="" class="caption">
						<p class="text-justify">If you're like this guy -- Russian-Italian Jewish, with hair covering every inch and a bonafide man-bun in the post-Wall era -- then we suggest you sign up already.</p>
					</div>
				</div>
			</div>
			<div class="col-sm-6 col-md-4">
				<div class="thumbnail">
					<a data-toggle="modal" data-target="#logInForm" role="button">
						<img class="img-rounded img-responsive" src="./imgs/log-in-thumbnail.jpeg" alt="Log In">
						<div class="caption">
							<h3 class="text-center">Log In</h3>
						</div>
					</a>
					<div class="caption">
						<p class="text-justify">Mickey went out into the cold to the zombie server farm.  There he sourced your username and password from the desecration, so the least you could do is log in with your credentials.</p>
					</div>
				</div>
			</div>
			<div class="col-sm-6 col-md-4">
				<div class="thumbnail">
					<a href="#" role="button">
						<img class="img-rounded img-responsive" src="./imgs/play-now-thumbnail.jpeg" alt="Play Now">
						<div class="caption">
							<h3 class="text-center">Play Now</h3>
						</div>
					</a>
					<div class="caption">
						<p class="text-justify">A long time ago, a young plebeian fell in love with a Princess of Grandeur.  All was peaceful in the land until he was subsequently choked by her father.  Heed this warning if you simply cannot wait to play.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Sign Up Modal -->
	<div id="signupForm" class="modal fade" role="dialog">
		<div class="modal-dialog modal-lg">
			<!-- Modal content -->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span></button>
					<h4 class="modal-title text-center">Sign Up!</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal">
						<div class="form-group">
							<label class="control-label col-sm-4" for="first name">First Name:</label>
							<div class="col-sm-6">
								<input type="text" class="form-control" id="firstName" placeholder="Enter first name">
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-4" for="last name">Last Name:</label>
							<div class="col-sm-6">
								<input type="text" class="form-control" id="lastName" placeholder="Enter last name">
							</div>
						</div>					
						<div class="form-group">
							<label class="control-label col-sm-4" for="email">Email:</label>
							<div class="col-sm-6">
								<input type="text" class="form-control" id="signUpEmail" placeholder="Enter email">
							</div>
						</div>	
						<div class="form-group">
							<label class="control-label col-sm-4" for="pwd">Password:</label>
							<div class="col-sm-6">
								<input type="password" class="form-control" id="signUpPwd" placeholder="Enter password">
							</div>
						</div>
						<div class="form-group"> 
							<div class="col-sm-offset-4 col-sm-6">
								<div class="checkbox">
									<label><input type="checkbox"> Remember me</label>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-4 col-sm-6">
								<button id="signup_button" type="submit" class="btn btn-primary">Submit</button>
								<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<div id="signUpAlert" class="alert fade in text-left" role="alert" style="display: none;">
					</div>
				</div>
			</div>
		</div>
	</div>
		<!-- Log In Modal -->
	<div id="logInForm" class="modal fade" role="dialog">
		<div class="modal-dialog modal-lg">
			<!-- Modal content -->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span></button>
					<h4 class="modal-title text-center">Log In!</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal">					
						<div class="form-group">
							<label class="control-label col-sm-4" for="email">Email:</label>
							<div class="col-sm-6">
								<input type="text" class="form-control" id="email" placeholder="Enter email">
							</div>
						</div>	
						<div class="form-group">
							<label class="control-label col-sm-4" for="pwd">Password:</label>
							<div class="col-sm-6">
								<input type="password" class="form-control" id="pwd" placeholder="Enter password">
							</div>
						</div>
						<div class="form-group"> 
							<div class="col-sm-offset-4 col-sm-6">
								<div class="checkbox">
									<label><input type="checkbox"> Remember me</label>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-4 col-sm-6">
								<button type="button" id="login_button" class="btn btn-primary">Log In</button>
								<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
					<div id="logInAlert" class="alert fade in text-left" role="alert" style="display: none;">
					</div>
				</div>
			</div>
		</div>
	</div>
	 <!-- Tab and Quiz Arena -->
	 <div id="quiz" style="display: none;" class="container">
	 	<!-- Pill navigator -->
	 	<ul class="nav nav-tabs nav-justified">
	 		<li class="active"><a href="#bob" data-toggle="pill">The Real Bob</a></li>
	 		<li><a href="#johnCorinna" data-toggle="pill">JC &amp; the Girls</a></li>
	 		<li><a href="#edRich" data-toggle="pill">Ed &amp; Rich</a></li>
	 		<li><a href="#eliseDianeKristen" data-toggle="pill">The Royalty</a></li>
	 	</ul>

	 	<!-- Pill content -->
	 	<div class="tab-content">
	 		<div id="#bob" class="tab-pane fade in active">
	 			<div class="table-responsive">
	 				<table class="table table-hover">
	 					<thead>
	 						<tr style="pointer-events: none;">
	 							<th id="prompt"></th>
	 						</tr>
	 					</thead>
	 					<tbody id="choices">
	 						<tr><td id="choice_0_text"></td></tr>
	 						<tr><td id="choice_1_text"></td></tr>
	 						<tr><td id="choice_2_text"></td></tr>
	 						<tr><td id="choice_3_text"></td></tr>
	 						<tr><td id="choice_4_text"></td></tr>
	 					</tbody>
	 				</table>
	 				
	 			</div>
	 		</div>
	 		<div id="#johnCorinna" class="tab-pane fade">
	 			<h3>Menu 1</h3>
	 			<p>Some content in menu 1.</p>
	 		</div>
	 		<div id="#edRich" class="tab-pane fade">
	 			<h3>Menu 2</h3>
	 			<p>Some content in menu 2.</p>
	 		</div>
	 		<div id="#eliseDianeKristen" class="tab-pane fade">
	 			<h3>Menu 3</h3>
	 			<p>Some content in menu 2.</p>
	 		</div>
	 	</div>
	 </div>

	<div id="quiz" style="display: none;">
		<p>
			<div id="container">
				<div id="container_prompt">
					<h4 id="prompt" class="text-center"></h4>
				</div>
				<div id="container_choices">
					<table id="choices">
						<tr id="0">
							<td><h3 id="choice_0_text"></h3></td>
						</tr>
						<tr id="1">
							<td><h3 id="choice_1_text"></h3></td>
						</tr>
						<tr id="2">
							<td><h3 id="choice_2_text"></h3></td>
						</tr>
						<tr id="3">
							<td><h3 id="choice_3_text"></h3></td>
						</tr>
						<tr id="4">
							<td><h3 id="choice_4_text"></h3></td>
						</tr>
					</table>
				</div>
			</div>
		</p>
		<p>
			<div id="nav" style="display: none;">
				<div id="back"><p>Back</p></div>
				<div id="next"><p>Next</p></div>
			</div>
		</p>
		<p>
			<div id="counter"><p><strong id="counter_text"></strong> / 22</p></div>
		</p>
		<div id="final" style="display: none;"><h4 id="finalDisplay"></h4></p></div>
		<div id="reset" style="display: none;"><p>Reset</p></div>
	</div>

	<!-- Bob Quotes -->
	<div class="container">
		<blockquote>
			<p>Mickey Bite!</p>
			<footer>Annoyed Bob in <cite title="Source Title">The Kids Came Home</cite></footer>
		</blockquote>
	</div>

	<!-- Footer -->
	<nav class="navbar navbar-default navbar-fixed-bottom">
		<div class="container-fluid">
			<p class="text-center navbar-text">Copyright &copy; The Sticky Mickey Corporation, a subsidiary of Nasty-Wags Intl., all rights reserved.</p>
			<ul class="nav navbar-nav navbar-right">
				<li><a href="#" data-toggle="tooltip" data-placement="auto" title="He's gonna need it.">Donate</a></li>
				<li><a href="#">Contact</a></li>
			</ul>
		</div>
	</nav>
</body>
</html>
