<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
	<title>Who is Bob Campbell</title>
	<link rel="stylesheet" type="text/css" href="./css/BobQuiz_style.css">
	<link rel="stylesheet" type="text/css" href="./css/bootstrap.min.css">
	<script type="text/javascript" src="./js/jquery-3.1.1.js"></script>
	<script type="text/javascript" src="./js/bootstrap.min.js"></script>
	<script type="text/javascript" src="./js/CookieFunctions.js"></script>
	<script type="text/javascript" src="./js/BobQuiz_questions.js"></script>
	<script type="text/javascript">
		var answers = new Array(); //questions array defined in BobQuiz_questions.js
		var currentQuestion = 0;
		var NUMBER_OF_CHOICES = 5;
		var SPEED = 150; //milliseconds
		var emailtemp;

		$(document).ready(function() {
			updateUI();
			function updateUI() {
				var question = questions[currentQuestion];
				var choices = question.choices;
				var myData;
				$("#prompt").text(question.prompt);
				for (var i =  NUMBER_OF_CHOICES - 1; i >= 0; i--) {
					var myData = $("#choice_" + i + "_text");
					myData.text(choices[i]);
				}
				if (currentQuestion < answers.length) {
					var choice = $("tr").siblings()[answers[currentQuestion]];
					$(choice).addClass("active");
					$("#next").removeClass("inactive");
				}
				if (currentQuestion >= answers.length) {$("#next").addClass("inactive");}
				$("#counter_text").text(currentQuestion + 1);
				$("#container").animate({opacity:1.0}, SPEED);
			}

			$("#login_button").click(function() {
				var email = $("#email").val();
				var pass = $("#password").val();
				if (!email || !pass) {
					alert("Please enter both your email and password.");
					return;
				} else {
					// create the email and pass check 
					if (typeof(Storage) !== "undefined") {
						if (localStorage[email]) {
							if (pass == localStorage[email]) {
								//animate the acceptance of login credentials
								showWelcome("#myForm", email);
							} else {
								alert("Your password does not match.  Please try again.");
								return;
							}
						} else {
							alert("You must be a new user.  Please click the Sign Up button.");
							return;
						}
					} else {
						alert("Sorry there is no web storage support!");
						return;
					}
				}
			});

			$("#signup_button").click(function() {
				var email = $("#email").val();
				var pass = $("#password").val();
				if (!email || !pass) {
					alert("Please enter both your email and password.");
					return;
				} else {
					if (localStorage[email]) {
						alert("You're already signed up.  Please Log In.");
						return;
					} else {
						localStorage.setItem(email, pass);
						emailtemp = email;
						//animate change to sign up form and hide myForm, set cookie
						$("#myForm").animate({opacity: '0.0'}, "fast", function() {
							$("#myForm").hide();
							$("#signupForm").show();
						});
					}
				}
			});

			$("#finish_button").click(function() {
				setCookie(emailtemp, $("#firstName").val() + " " + $("#lastName").val());
				//animate the acceptance of login credentials
				showWelcome("#signupForm", emailtemp);
			});

			function showWelcome(container, id) {
				var name = getCookieValue(id);
				name = name.replace(/[\s,]\w*/,""); // RegEx to search for space or comma and rest of string and replace with ""
				if (name) {
					$(container).animate({opacity: '0.0'}, "fast", welcomeMsg);
				} else {
					alert("Sorry but we could not find your name in our registry");
				}
				function welcomeMsg() {
						$(container).hide();
						var welcText = "Welcome";
						container == "#myForm" ? welcText += " back to the jungle, ":welcText += " to Bob's quiz, "; // Fast enumeration of if statement
						welcText += name + "!";
						$("#welcome_header").text(welcText);
						$("#welcome").show();
						setTimeout(showQuiz, 3000); // Show the welcome for 3 seconds
				}
				function showQuiz() {
					$("#login").animate({opacity: 0.0}, "fast", function() {
						$("#login").hide();
						$("#quiz").show();
						$("#nav").show();
					});
				}
			}

			$("#next").click(function() {
				var myAnswer = $("#choices").children().children("tr.active");
				if (myAnswer.length == 0) {
					alert("Select an answer or the puppy gets it!");
					return;					
				}
				else {
					//log answer and prep for next question
					$("tr").removeClass("active");
					var myAnswer = myAnswer.attr("id");
					myAnswer = parseInt(myAnswer);
					if (currentQuestion < questions.length - 1) {
						answers[currentQuestion] = myAnswer; 
						currentQuestion++;
						//do quick animation of transition first
						$("#container").animate({opacity:0.0}, SPEED, updateUI);
					} else {
						$("#container").animate({opacity:0.0}, SPEED, presentScore);
					}
				}
			});

			$("#back").click(function() {
				if (currentQuestion <= 0) {
					return;
				} else {
					$("#container").animate({opacity:0},SPEED,updateUI);
					$("tr").removeClass("active");
					currentQuestion --;
				}
			});

			$("tr").click(function() {
				$(this).toggleClass("active");
				$(this).siblings("tr.active").toggleClass("active");
				if ($("#choices").children().children("tr.active").length == 0) {
					$("#next").addClass("inactive");				
				} else {
					$("#next").removeClass("inactive");									
				}
			});

			function presentScore() {
				var final = document.getElementById("final");
				var score = tallyScore();
				var totalQuestions = questions.length;
				var percentScore = Math.round(100 * score / totalQuestions);
				if (percentScore > 80.0) {
					$("#prompt").text("Wow! How do you know all of Bob's secrets? Are you God?");
				} else if (percentScore > 45.0) {
					$("#prompt").text("Definitely cheating off of Hector.");
				} else if (percentScore > 25.0) {
					$("#prompt").text("Mickey still nose more than you.");
				} else {
					$("#prompt").text("Who is this? Someone call security...Odie!");
				}
				$("#container").animate({opacity:1.0}, SPEED);
				$("#container_choices").hide();
				$("#back").hide();
				$("#counter").hide();
				$("#next").hide();
				$("#container_prompt").append(final);
				$("#final").show();
				$("#reset").show();
				$("#finalDisplay").text("Your final score is " + percentScore + "%!\n" + "You correctly answered " + score + " / " + totalQuestions + ".");
			}

			function tallyScore() {
				var tally = 0;
				for (var i = 0; i < questions.length - 1; i++) {
					if (answers[i] == questions[i].correctAnswer) {
						tally++;
					}
				}
				return tally;
			}	

			$("#reset").click(function() {
				$("#container").animate({opacity:0.0}, 2 * SPEED, updateUI);
				$("#container_choices").show();
				$("#back").show();
				$("#counter").show();
				$("#next").show();
				$("#final").hide();
				$("#reset").hide();
				currentQuestion = 0;
				answers = new Array();
			});

			// $('[data-toggle="tooltip"]').tooltip();
		});
</script>
</head>
<body>
<!-- Top Navigation bar -->
	<nav class="navbar navbar-inverse">
		<div class="container-fluid">
			<div class="navbar-header">
				<a class="navbar-brand" href="#">Campbell Clan</a>
			</div>
			<ul class="nav navbar-nav">
				<li class="active"><a href="#">Home</a></li>
				<li><a href="#">Leaderboards</a></li>
				<li><a href="#">About</a></li>
			</ul>
			<ul class="nav navbar-nav navbar-right">
				<li><a href="#"><span class="glyphicon glyphicon-log-in"></span> Log In</a></li>
				<li><a href="#"><span class="glyphicon glyphicon-user"></span> Sign Up</a></li>
			</ul>
		</div>
	</nav>
	<!-- Jumbotron -->
	<div class="container">
		<div class="jumbotron">
			<h1>The Campbell Clan Quiz</h1>
			<p><span class="label label-primary">Discover</span> the real Bob Campbell and why Brad should be <span class="label label-danger">scared.</span></p>
		</div>
	</div>
	<!-- Home page buttons -->
	<div class="container">
		<div class="row">
			<div class="col-sm-6 col-md-4">
				<div class="thumbnail">
					<a data-toggle="modal" data-target="#signupForm" role="button">
						<img class="img-rounded img-responsive" src="./imgs/sign-up-thumbnail.png" alt="Sign Up">
						<div class="caption">
							<h3 class="text-center">Sign Up</h3>
						</div>
					</a>
					<div class="caption">
						<p class="text-justify">If you're like this guy -- Russian-Italian Jewish, with hair covering every inch and a bonafide man-bun in the post-Wall era -- then we suggest you sign up already.</p>
					</div>
				</div>
			</div>
			<div class="col-sm-6 col-md-4">
				<div class="thumbnail">
					<a data-toggle="modal" data-target="#logInForm" role="button">
						<img class="img-rounded img-responsive" src="./imgs/log-in-thumbnail.jpeg" alt="Log In">
						<div class="caption">
							<h3 class="text-center">Log In</h3>
						</div>
					</a>
					<div class="caption">
						<p class="text-justify">Mickey went out into the cold to the zombie server farm.  There he sourced your username and password from the nothingness, so the least you could do is log in with your credentials.</p>
					</div>
				</div>
			</div>
			<div class="col-sm-6 col-md-4">
				<div class="thumbnail">
					<a href="#" role="button">
						<img class="img-rounded img-responsive" src="./imgs/play-now-thumbnail.jpeg" alt="Play Now">
						<div class="caption">
							<h3 class="text-center">Play Now</h3>
						</div>
					</a>
					<div class="caption">
						<p class="text-justify">A long time ago, a young plebeian fell in love with a Princess of Grandeur.  All was peaceful in the land until he was subsequently choked by her father.  Heed this warning if you simply cannot wait to play.</p>
					</div>
				</div>
			</div>
		</div>
	</div>
	<!-- Sign Up Modal -->
	<div id="signupForm" class="modal fade" role="dialog">
		<div class="modal-dialog modal-lg">
			<!-- Modal content -->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span></button>
					<h4 class="modal-title text-center">Sign Up!</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal">
						<div class="form-group">
							<label class="control-label col-sm-4" for="first name">First Name:</label>
							<div class="col-sm-6">
								<input type="text" class="form-control" id="firstName" placeholder="Enter first name">
							</div>
						</div>
						<div class="form-group">
							<label class="control-label col-sm-4" for="last name">Last Name:</label>
							<div class="col-sm-6">
								<input type="text" class="form-control" id="lastName" placeholder="Enter last name">
							</div>
						</div>					
						<div class="form-group">
							<label class="control-label col-sm-4" for="email">Email:</label>
							<div class="col-sm-6">
								<input type="text" class="form-control" id="email" placeholder="Enter email">
							</div>
						</div>	
						<div class="form-group">
							<label class="control-label col-sm-4" for="pwd">Password:</label>
							<div class="col-sm-6">
								<input type="password" class="form-control" id="pwd" placeholder="Enter password">
							</div>
						</div>
						<div class="form-group"> 
							<div class="col-sm-offset-4 col-sm-6">
								<div class="checkbox">
									<label><input type="checkbox"> Remember me</label>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-4 col-sm-6">
								<button type="submit" class="btn btn-primary">Submit</button>
								<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
				</div>
			</div>
		</div>
	</div>
		<!-- Log In Modal -->
	<div id="logInForm" class="modal fade" role="dialog">
		<div class="modal-dialog modal-lg">
			<!-- Modal content -->
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"><span class="glyphicon glyphicon-remove"></span></button>
					<h4 class="modal-title text-center">Log In!</h4>
				</div>
				<div class="modal-body">
					<form class="form-horizontal">					
						<div class="form-group">
							<label class="control-label col-sm-4" for="email">Email:</label>
							<div class="col-sm-6">
								<input type="text" class="form-control" id="email" placeholder="Enter email">
							</div>
						</div>	
						<div class="form-group">
							<label class="control-label col-sm-4" for="pwd">Password:</label>
							<div class="col-sm-6">
								<input type="password" class="form-control" id="pwd" placeholder="Enter password">
							</div>
						</div>
						<div class="form-group"> 
							<div class="col-sm-offset-4 col-sm-6">
								<div class="checkbox">
									<label><input type="checkbox"> Remember me</label>
								</div>
							</div>
						</div>
						<div class="form-group">
							<div class="col-sm-offset-4 col-sm-6">
								<button type="button" class="btn btn-primary">Go!</button>
								<button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
							</div>
						</div>
					</form>
				</div>
				<div class="modal-footer">
				</div>
			</div>
		</div>
	</div>
<!-- 
	<div id="login">
		<p>
			<form id="myForm">
				<h4>Please log in or sign up.</h4>
				<p><div class="intro">Email:</div><input type="text" id="email" placeholder="Enter your email"/></p>
				<p><div class="intro">Password:</div><input type="password" id="password" placeholder="Enter your password" /></p>
				<p><input type="button" id="login_button" value="Log In" /><br/><input type="button" id="signup_button" value="Sign Up"></p>
			</form>
			<form id="signupForm" style="display: none;">
				<h4>Please enter your name.</h4>
				<p><div class="intro">First Name:</div><input type="text" id="firstName" placeholder="Enter your first name"/></p>
				<p><div class="intro">Last Name:</div><input type="text" id="lastName" placeholder="Enter your last name" /></p>
				<p><input type="button" id="finish_button" value="Finish"></p>
			</form>
			<div id="welcome" style="display: none;"><h4 id="welcome_header"></h4></div>
		</p>
	</div>
	 -->
	 <!--  -->
	<div id="quiz" style="display: none;">
		<p>
			<div id="container">
				<div id="container_prompt">
					<h4 id="prompt"></h4>
				</div>
				<div id="container_choices">
					<table id="choices">
						<tr id="0">
							<td><h3 id="choice_0_text"></h3></td>
						</tr>
						<tr id="1">
							<td><h3 id="choice_1_text"></h3></td>
						</tr>
						<tr id="2">
							<td><h3 id="choice_2_text"></h3></td>
						</tr>
						<tr id="3">
							<td><h3 id="choice_3_text"></h3></td>
						</tr>
						<tr id="4">
							<td><h3 id="choice_4_text"></h3></td>
						</tr>
					</table>
				</div>
			</div>
		</p>
		<p>
			<div id="nav" style="display: none;">
				<div id="back"><p>Back</p></div>
				<div id="next"><p>Next</p></div>
			</div>
		</p>
		<p>
			<div id="counter"><p><strong id="counter_text"></strong> / 22</p></div>
		</p>
		<div id="final" style="display: none;"><h4 id="finalDisplay"></h4></p></div>
		<div id="reset" style="display: none;"><p>Reset</p></div>
	</div>
	<div class="container">
		<blockquote>
			<p>Mickey Bite!</p>
			<footer>Annoyed Bob in <cite title="Source Title">The Kids Came Home</cite></footer>
		</blockquote>
	</div>
	<nav class="navbar navbar-default navbar-fixed-bottom">
		<div class="container-fluid">
			<p class="text-center navbar-text">Copyright © The Sticky Mickey Corporation, a subsidiary of Nasty-Wags Intl., all rights reserved.</p>
			<ul class="nav navbar-nav navbar-right">
				<li><a href="#" data-toggle="tooltip" data-placement="auto" title="He's gonna need it.">Donate</a></li>
				<li><a href="#">Contact</a></li>
			</ul>
		</div>
	</nav>
</body>
</html>
